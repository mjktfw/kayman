#! /bin/bash
# https://github.com/shakibamoshiri/bash-CLI-template

  APP_DIR="${KMN_DIR}"
  APP_DIR="${APP_DIR}" . "${APP_DIR}/app/env"

function __add() (

  # if [[ ${#} == 0 ]]; then
  #     decrypt_help;
  # fi

  ################################################################################
  # arguments

  function parse_opts() {

    while [ ${#} -gt 0 ]; do
      case "$1" in
        -- ) break ;;
        -k | --key-name ) opts[KEY_NAME]="${2:?$ERR_MSG}" ; shift 2 ;;
        -d | --dir ) opts[s]="${2:?$ERR_MSG}" ; shift 2 ;;
        -* ) echo >&2 "$0: Error in usage." ; exit 1 ;;
        * )  break ;;
      esac
    done

    args=("$@")
  }

  declare args
  declare -A opts
  parse_opts $@

  ################################################################################
  # body

  local pubkey_path="${HOME}/.ssh/${opts[KEY_NAME]}.pub"
  echo $pubkey_path
  # # TODO: assure it's public, not private
  # cp "${pubkey_path}" "${PUBKEY_DIR}/pub/"

  # (cd "${PUBKEY_DIR}" &&
  #     git add --all . &&
  #     git commit -m "${KEY_NAME}";
  #     git push)

  exit 0;
)

function main() (

  ################################################################################
  # arguments

  function parse_opts() {

    while [ ${#} -gt 0 ]; do
      case "$1" in
        -- ) break ;;
        # -c | --center ) opts[c]="$2" ; shift 2 ;;
        # -V | --version ) version ; exit 0 ;;
        -* ) echo >&2 "$0: Error in usage." ; exit 1 ;;
        * )  break ;;
      esac
    done

    args=("$@")
  }

  declare args
  declare -A opts
  parse_opts $@

  ################################################################################
  # body

  ################################################################################
  # caller

  if (( ${#} == 0 )); then
    echo >&2 "No arguments";
  fi

  case "${args[0]}" in
    keygen ) __keygen "${args[@]:1}" ;;
    add ) __add "${args[@]:1}" ;;
    * )
      echo >&2 "Unknown command: $1";
      # main_help 1;
      exit 1;
    ;;
  esac
)

main "$@"
