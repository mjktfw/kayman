#! /bin/bash

APP_DIR="${KMN_DIR}"
APP_DIR="${APP_DIR}" . "${APP_DIR}/app/env"

OPTSTRING=":r:k:"
while getopts ${OPTSTRING} opt; do
  case ${opt} in
    r)
      PUBKEY_DIR="${OPTARG}"
      ;;
    k)
      KEY_NAME="${OPTARG}"
      ;;
    ?)
      echo "Invalid option: -${OPTARG}."
      exit 1
      ;;
  esac
done

pubkey_path="${HOME}/.ssh/${KEY_NAME}.pub"

# TODO: assure it's public, not private
cp "${pubkey_path}" "${PUBKEY_DIR}/pub/"

(cd "${PUBKEY_DIR}" &&
    git add --all . &&
    git commit -m "${KEY_NAME}";
    git push)
