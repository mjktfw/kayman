#! /bin/bash

APP_DIR="${KMN_DIR}"
APP_DIR="${APP_DIR}" . "${APP_DIR}/app/env"

OPTSTRING=":u:r:d:"
while getopts ${OPTSTRING} opt; do
  case ${opt} in
    u)
      PUBKEY_USERNAME="${OPTARG}"
      ;;
    r)
      PUBKEY_REPO="${OPTARG}"
      ;;
    d)
      PUBKEY_DIR="${OPTARG}"
      ;;
    ?)
      echo "Invalid option: -${OPTARG}."
      exit 1
      ;;
  esac
done

repo_ssl="https://github.com/${PUBKEY_USERNAME}/${PUBKEY_REPO}.git"
repo_ssh="git@github.com:${PUBKEY_USERNAME}/${PUBKEY_REPO}.git"

[ ! -d "${PUBKEY_DIR}/.git" ] &&
  git clone "${repo_ssl}" "${PUBKEY_DIR}"

(cd "${PUBKEY_DIR}" &&
  git pull)

(cd "${PUBKEY_DIR}" &&
  git remote set-url --push origin "${repo_ssh}")
